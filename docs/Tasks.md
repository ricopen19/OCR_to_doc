# Tasks

未完タスクのみをここに残します。完了した項目は `docs/change_log.md` に集約します。

## フェーズ別ロードマップ

### フェーズ 1：PDF→Markdown 精度と前処理（現行フェーズ）
- [ ] 精度評価のルールを整備し、1 ドキュメントあたりの誤検出／修正ポイントを記録できるノート（例: `docs/poc_results/`）へ追記する。

### フェーズ 2：テキスト PDF / エクスポート強化
- [ ] `text_pdf.py` で `markitdown` や `pdfplumber` を用いたテキスト整形パイプラインを構築し、画像ルートと同じ `*_merged.md` 形式を出力する。

### フェーズ 3：fallback と高度化
- [ ] fallback チェーン（例: YomiToku lite→full→Tesseract/PaddleOCR 等）を「ページ単位で」組み合わせ、失敗ページを自動再処理できるようにする（現状は Tesseract の単発フォールバックのみ）。
- [ ] fallback 結果や処理時間を構造化ログ化し、どのページがどのエンジンで確定したか追跡できるようにする（GUI の進捗/ログとも整合させる）。
- [ ] エクスポート層では Markdown→xlsx や GUI 連携など長期テーマに着手する。

## 優先度高 (Short-term)
- [ ] 要件テンプレート（`docs/requirements_template.md` 等）を使い、次の検証テーマごとに成功指標・制約を事前に書き出す運用を定着させる。
- [ ] GUI/E2E：Tauri 実行（実プロセス）で「D&D→実行→結果表示」までの E2E を整備する（現状は Vite dev + モックのみ）。

### GUI 機能改善 / 追加機能
- [ ] 設定の反映漏れを解消：`outputRoot`（出力先）を `dispatcher.py --output-root` に接続し、GUI から実際に変更できるようにする。
- [ ] 入力拡張：GUI の受け付け拡張子を CLI と合わせる（例: webp/tif/svg/heif 等）＋フォルダドロップ対応を検討する。
- [ ] 実行画面改善：複数入力のときに「ファイルごとの進捗」と「全体進捗」を区別して表示する。
- [ ] 結果画面改善：Markdown 以外（docx/xlsx）の簡易プレビュー（最低限: ファイル情報/サイズ/更新日時）を追加する。
- [ ] Excel 変換の仕様固め：複数ページの扱い（シート分割/結合）、命名規則、GUI 表示（どの xlsx が最終成果物か）を明確化する。

## 中期 (Mid-term)
- [ ] エラー処理とログ強化：OCR 失敗やファイル I/O 例外を捕捉し、再実行しやすい CLI メッセージとログファイルを整備する。
- [ ] CLI UX 向上：Click/argparse で ingest→OCR→マージ→エクスポートを一連のコマンドとしてまとめる。
- [ ] Windows CI のカバレッジ拡張：現在稼働中の GitHub Actions（Windows CI）にサンプル PDF を使った smoke test を追加し、前処理〜マージまでを自動検証できるようにする。
- [ ] プレーンテキスト + 後工程整形のワークフローを固め、LLM/人手どちらでも整形できる「作業指針」をドキュメント化する。
- [ ] 図版の手動マーキング→トリミング→Markdown 反映までを補助する GUI/ツール案を整理しておき、必要性が高まったら PoC へ進める。
- [ ] layoutparser 等のレイアウト解析ライブラリ導入可否を継続調査する。
- [ ] 画像前処理パイプライン：`image_preprocessor.py` の `ocr_default` を基点に、用途別プロファイルを個別実行で検証（スクショ向けの DPI 調整・二値化・ノイズ除去・傾き補正など）し、PDF 経路と同等の安定性を確保する。

## 低優先 (Backlog)
- [ ] YomiToku パラメータチューニング（`--mode full` や閾値の細かな調整）は当面 lite + 既定設定で据え置き、前処理・整形が安定した段階で再検討する。
- [ ] Pix2Text など追加 OCR/数式エンジンの導入検討は、Markdown 精度が十分得られてから着手する。
- [ ] SVG → PNG 変換品質の検証：フォント依存を解消する方式（必要フォントの同梱/設定、アウトライン化フロー、Fontconfig 設定ファイル）の比較メモを作り、優先度が上がったタイミングで実装案をまとめる。

## 自動化 TODO（Cleanup pipeline）
- [ ] 画像参照の整理: `ocr.py` の小型アイコンフィルタをログで検証しつつ、単色・重複画像を段階的に除外できるよう閾値調整と結果レポート（例: `icon_candidates.json`）を追加する。
- [ ] 記号・ギリシャ文字の統一: 誤 OCR 例（σ→o、ρ→p 等）を収集し、`markdown_cleanup.py` に置換テーブルを設けて自動補正する。対象一覧をメンテしやすい YAML/JSON へ切り出すことも検討。
- [ ] 簡単な分数・数式の整形: `MTBF/MTBF+MTTR` など頻出パターンを正規表現で検出し、`$\frac{...}{...}$` など LaTeX 形式へ変換するオプションを `markdown_cleanup.py` に追加する。対象式のテンプレートを決めた上で段階的に拡張する。

## 長期 (Long-term)
- [ ] Excel 出力機能: Markdown から Excel へ変換するパイプラインの設計・実装。
- [ ] クラウド OCR 連携: CPU で重い処理を軽減するために Azure / Google Vision などクラウド OCR とのハイブリッド運用を検討する。
- [ ] ローカル LLM 連携: データを外部へ出さずに整形精度を高めるオプションを PoC→実装の流れで検討する。
